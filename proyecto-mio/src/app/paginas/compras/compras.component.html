<div class="matrix-container">
  <!-- Formulario de Compra -->
  <div class="matrix-form">
    <h2 class="matrix-title">Formulario de Compra</h2>
    <form [formGroup]="formularioCompra" (ngSubmit)="finalizarCompra()">

      <!-- Nombre y Teléfono -->
      <div class="matrix-row">
        <div class="matrix-col matrix-field">
          <label for="nombre">Nombre <span>*</span></label>
          <input id="nombre" formControlName="nombre" placeholder="Tu Nombre Completo">
          <div *ngIf="formularioCompra.get('nombre')?.touched && formularioCompra.get('nombre')?.invalid" class="matrix-error">
            El nombre es obligatorio.
          </div>
        </div>

        <div class="matrix-col matrix-field">
          <label for="telefono">Teléfono <span>*</span></label>
          <input id="telefono" formControlName="telefono" placeholder="Ej: +54 9 11 1234 5678">
          <div *ngIf="formularioCompra.get('telefono')?.touched && formularioCompra.get('telefono')?.invalid" class="matrix-error">
            El teléfono es obligatorio.
          </div>
        </div>
      </div>

      <!-- Correo -->
      <div class="matrix-field">
        <label for="correo">Correo Electrónico <span>*</span></label>
        <input id="correo" formControlName="correo" type="email" placeholder="Ejemplo@correo.gmail">
        <div *ngIf="formularioCompra.get('correo')?.touched && formularioCompra.get('correo')?.invalid" class="matrix-error">
          El correo es obligatorio.
        </div>
      </div>

      <!-- Dirección -->
      <div class="matrix-field">
        <label for="direccion">Dirección <span>*</span></label>
        <input id="direccion" formControlName="direccion" placeholder="Calle, número, piso, depto">
        <div *ngIf="formularioCompra.get('direccion')?.touched && formularioCompra.get('direccion')?.invalid" class="matrix-error">
          La dirección es obligatoria.
        </div>
      </div>

      <!-- Ciudad, Provincia, Código Postal -->
      <div class="matrix-row">
        <div class="matrix-col matrix-field">
          <label for="ciudad">Ciudad <span>*</span></label>
          <input id="ciudad" formControlName="ciudad" placeholder="Ej: Buenos Aires">
          <div *ngIf="formularioCompra.get('ciudad')?.touched && formularioCompra.get('ciudad')?.invalid" class="matrix-error">
            La ciudad es obligatoria.
          </div>
        </div>

        <div class="matrix-col matrix-field">
          <label for="provincia">Provincia <span>*</span></label>
          <input id="provincia" formControlName="provincia" placeholder="Ej: Buenos Aires">
          <div *ngIf="formularioCompra.get('provincia')?.touched && formularioCompra.get('provincia')?.invalid" class="matrix-error">
            La provincia es obligatoria.
          </div>
        </div>

        <div class="matrix-col matrix-field">
          <label for="codigoPostal">Código Postal <span>*</span></label>
          <input id="codigoPostal" formControlName="codigoPostal" placeholder="Ej: 1428">
          <div *ngIf="formularioCompra.get('codigoPostal')?.touched && formularioCompra.get('codigoPostal')?.invalid" class="matrix-error">
            El código postal es obligatorio.
          </div>
        </div>
      </div>

      <!-- Método de pago -->
     <div class="matrix-field">
  <label for="metodoPago">Método de Pago <span>*</span></label>
  <select id="metodoPago" formControlName="metodoPago">
    <option value="" disabled selected>Seleccione método de pago</option>
    <option value="efectivo">Efectivo</option>
    <option value="transferencia">Transferencia</option>
  </select>

  <!-- Mensaje especial para transferencia -->
  <div *ngIf="formularioCompra.get('metodoPago')?.value === 'transferencia'" class="matrix-error" style="margin-top: 8px; color: #66ff99; text-shadow: 0 0 6px #00ff66;">
    En caso de transferencia, transferir a este alias: <strong>echaures</strong> y luego mandar comprobante.
  </div>

  <div *ngIf="formularioCompra.get('metodoPago')?.touched && formularioCompra.get('metodoPago')?.invalid" class="matrix-error">
    Debes seleccionar un método de pago.
  </div>
</div>


      <!-- Resumen y botón -->
      <div class="matrix-summary">
        <p>Envío: ${{envio.toFixed(2)}}</p>
        <p><strong>Total a Pagar: ${{calcularTotal() | number: '1.2-2'}}</strong></p>
        <button type="submit" class="btn-matrix-comprar">
          <span>Finalizar Compra</span>
          <div class="matrix-glow"></div>
        </button>
      </div>
    </form>
  </div>

  <!-- Modal PDF -->
  <div *ngIf="mostrarModal" class="matrix-modal-overlay">
    <div class="matrix-modal">
      <div class="matrix-modal-header">
        <h5 class="matrix-modal-title">Factura PDF</h5>
        <button type="button" class="matrix-modal-close" (click)="cerrarModal()">✖</button>
      </div>
      <div class="matrix-modal-body">
        <iframe *ngIf="pdfSrc" [src]="pdfSrc" id="pdfFrame"></iframe>
      </div>
      <div class="matrix-modal-footer">
        <button type="button" class="btn-matrix-comprar" (click)="imprimirPDF()">
          <span>Imprimir</span>
          <div class="matrix-glow"></div>
        </button>
        <button type="button" class="matrix-btn-secondary" (click)="cerrarModal()">Cerrar</button>
      </div>
    </div>
  </div>
</div>
